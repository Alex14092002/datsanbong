<!DOCTYPE html>
<html>
<head>
  <title>Thêm block mới</title>
  <style>
    /* CSS cho nút button */
    #addBlockButton {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
    }
    #addBlockButton:disabled {
      background-color: #CCCCCC;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Thêm block mới</h1>
  <form id="addBlockForm">
    <label for="time">Thời gian:</label>
    <input type="text" id="time" name="time" required><br><br>
    <label for="price">Giá:</label>
    <input type="text" id="price" name="price" required><br><br>
    <button type="submit" id="addBlockButton">Thêm block</button>
  </form>

  <div id="blocksContainer">
    <!-- Danh sách block sẽ được hiển thị tại đây -->
  </div>

<script>
const databaseURL = "https://sancaul-default-rtdb.firebaseio.com"; // Thay bằng URL của Firebase Realtime Database

const addBlockForm = document.getElementById("addBlockForm");
const addBlockButton = document.getElementById("addBlockButton");
const blocksContainer = document.getElementById("blocksContainer");

// Hiển thị danh sách block
async function displayBlocks() {
  blocksContainer.innerHTML = ''; // Xóa nội dung cũ

  try {
    const response = await fetch(`${databaseURL}/blocks.json`);
    const data = await response.json();
    
    for (const blockId in data) {
      const block = data[blockId];
      const blockItem = document.createElement("div");
      blockItem.textContent = `Time: ${block.time}, Price: ${block.price}`;
      blocksContainer.appendChild(blockItem);
    }
  } catch (error) {
    console.error("Lỗi khi tải danh sách block:", error);
  }
}

// Thêm block
addBlockForm.addEventListener("submit", async (event) => {
  event.preventDefault();

  const formData = new FormData(addBlockForm);
  const time = formData.get("time");
  const price = formData.get("price");

  if (time && price) {
    addBlockButton.disabled = true; // Tắt nút "Thêm block" trong thời gian chờ

    try {
      const response = await fetch(`${databaseURL}/blocks.json`, {
        method: "POST",
        body: JSON.stringify({
          time: time,
          price: price
        }),
        headers: {
          "Content-Type": "application/json"
        }
      });
      const data = await response.json();

      console.log("Block đã được thêm:", data);

      // Thêm block vào các sân ở các khu
      try {
        const khuResponse = await fetch(`${databaseURL}/khu.json`);
        const khuData = await khuResponse.json();
        
        for (const khuId in khuData) {
          const khu = khuData[khuId];
          for (const sanId in khu.sân) {
            try {
              await fetch(`${databaseURL}/khu/${khuId}/sân/${sanId}/blockItem.json`, {
                method: "POST",
                body: JSON.stringify({
                  time: time,
                  price: price,
                  status: "Trống"
                }),
                headers: {
                  "Content-Type": "application/json"
                }
              });
            } catch (error) {
              console.error("Lỗi khi thêm blockItem vào các sân:", error);
            }
          }
        }
      } catch (error) {
        console.error("Lỗi khi thêm blockItem vào các sân:", error);
      }

      addBlockButton.disabled = false; // Mở lại nút "Thêm block"
      alert("Đã thêm block thành công!"); // Hiển thị cảnh báo
      
      displayBlocks(); // Hiển thị lại danh sách block sau khi thêm
    } catch (error) {
      console.error("Lỗi khi thêm block:", error);
    }
  }
});

// Hiển thị danh sách block khi tải trang
displayBlocks();

</script>
</body>
</html>
